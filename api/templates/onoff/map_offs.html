{% extends "onoff/base.html" %}

{% block head %}
{{ super() }}
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<link rel="stylesheet" href="{{ url_for('static', filename='lib/leaflet/leaflet.css') }}" />
<link rel="stylesheet" href="{{ url_for('static', filename='lib/leaflet/plugins/leaflet.label.css') }}"/>
<script src="{{url_for('static', filename='lib/leaflet/leaflet-src.js') }}"></script>
<script src="{{ url_for('static', filename='lib/leaflet/plugins/leaflet.label.js') }}"></script>
<script src="{{ url_for('static', filename='lib/d3/d3.js') }}"></script>
<script src="{{ url_for('static', filename='js/map.js') }}"></script>
<script src="{{ url_for('static', filename='js/map_offs.js') }}"></script>
{% endblock %}

{% block dashboard %}
{{ super() }}
<div style="margin:2px; margin-top:10px">
<div class="btn-group" style="z-index:1000" role="form">
  <button id="line-btn" type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
Select Route    <span class="caret"></span>
  </button>
  <ul id="filter_line" class="dropdown-menu scrollable-menu" role="menu">
    <li role="presentation" class="dropdown-header">Route</li>
    <li role="presentation" class="divider"></li>
    {% for route in routes %}
    <li><a href="#">{{ route }}</a></li>
    {% endfor %}
  </ul>
</div>
<ul id="dir-tabs" class="nav nav-tabs navbar-right">
<li id="inbound-link" role="presentation" class="active disabled">
        <a href="#">Inbound</a>
    </li>
    <li id="outbound-link" role="presentation" class="disabled">
        <a href="#">Outbound</a>
    </li>
</ul>
<div id="map" style="width:100%; height:70vh; z-index:1"></div>
</div>
<script>
var dir_lookup = {};
var directions = {{ directions|tojson|safe }};
var map = new Map('map', 'map_offs/_details');

$(directions).each(function(index, item) {
    if(!dir_lookup.hasOwnProperty(item.rte_desc)) {
        dir_lookup[item.rte_desc] = {};
    }
    dir_lookup[item.rte_desc][item.dir] = item.dir_desc;
});

$('#filter_line a').on('click', function() {
    var dir = dir_lookup[this.text];
    var args = {"rte_desc":this.text};
    $('#dir-tabs li.disabled').removeClass('disabled');
    $("#line-btn").text(this.text+' ').append('<span class="caret"></span>');
    $("#outbound-link > a").text(dir[0]);
    $("#inbound-link > a").text(dir[1]);
    $('#outbound-link').removeClass('active');
    $('#inbound-link').addClass('active');
    map.activateRoute(args);
});

$('#dir-tabs > li > a').click( function() {
    $('#dir-tabs > li.active').removeClass('active');
    $(this).parent().addClass('active');
    var link = $(this).parent().attr('id');
    if(link == 'outbound-link') map.activateDir(0);
    if(link == 'inbound-link') map.activateDir(1);
});

</script>

{% endblock %}
