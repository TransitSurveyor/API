{% extends "onoff/base.html" %}

{% block head %}
{{ super() }}
<script src="//code.highcharts.com/highcharts.js"></script>
<!--script src="../static/js/charts.js"></script-->


{% endblock %}


{% block dashboard %}
{{ super() }}

<!-- dropdowns that trigger ajax call to update table based on selection -->
<table>
  <tr>
    <td style="padding-right:1em">
      <strong>Route:</strong>
    </td>
    <td>
      <div class="btn-group">
        <button id="line_btn" type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
        All    <span class="caret"></span>
        </button>
        <ul id="filter_line" class="dropdown-menu scrollable-menu" role="menu">
          <li role="presentation" class="dropdown-header">Route</li>
          <li role="presentation"><a href="#">All</a></li>
          <li role="presentation" class="divider"></li>

          <!-- func views.py::status()
                 func results from helper.py::Query.routes()

               returns a list of all routes that are queryable -->
          {% for route in routes %}
          <li><a href="#">{{ route }}</a></li>
          {% endfor %}
        </ul>
      </div>
    </td>
  </tr>
</table>

<div class="table-responsive">
  <table class="table table-striped">
    <thead id="thead">
      <tr>
        <th>Route</th>
        <th>Direction</th>
        <th>Target</th>
        <th>Complete</th>
      </tr>
    </thead> 
    <tbody id="status_table">
    </tbody>
  </table>
</div>


<!-- container for chart -->
<div id="status_chart" style="margin: 0 auto"></div>

<script>
    
    var chart;

    function build_options(container, title, categories, series) {
        
        //size of columns in chart
        var pointWidth = 30;//150; //30
        //set height of chart dynamically
        var h = (pointWidth + 10) * 1 * categories.length + 50 + 70;
        // + 10- distance between bars
        // * 2 - number of series
        // +50+70 - margins top + bottom
        // n - number of points
        return {
            chart: {
                type: 'bar',
                renderTo: container,
                height:h
            },
            title: {
                text: title
            },
            xAxis: {
                categories:categories
            },
            yAxis: {
                min: 0,
                max: 100,
                title: {
                    text: 'Percentage'
                }
            },
            legend: {
                reversed: true
            },
            plotOptions: {
                series: {
                    stacking: 'Percent'
                }
            },
            series:series
        }
    }
    
    function build_targets_table(data) {
        $(data).each(function(index, item) {
            var rte = '<td>'+item.rte_desc+'</td>';
            var dir = '<td>'+item.dir_desc+'</td>';
            var target = '<td>'+item.target+'</td>';
            var complete = '<td>'+item.complete+'</td>';
            console.log(item.complete);
            var row = '<tr>'+rte+dir+target+complete+'</tr>';
            $("#status_table").append(row);
        });
    }

    var targets = {{ targets|tojson|safe }};
    build_targets_table(targets)

       /*
       $.getJSON('data/_query', args, function(data) {
            //clear table and rebuild with fetched json
            $("#status_table").empty();
            $(data.records).each(function(index, item) {
                var date = '<td>'+item.date+'</td>';
                var time = '<td>'+item.time+'</td>';
                var user = '<td>'+item.user+'</td>';
                var line = '<td>'+item.line+'</td>';
                var dir = '<td>'+item.dir+'</td>';
                var on = '<td>'+item.on+'</td>';
                var off = '<td>'+item.off+'</td>';
                var row = '<tr>'+date+time+user+line+dir+on+off+'</tr>';
                $("#status_table").append(row);
            });
        });
        */



    /*
    function draw_chart(args) {
        var url = "status/_details";
        
        $.getJSON(url, args, function (data) {
            //console.log(data);
            for(var i=0; i < data.data.length; i++) {
                console.log(data.data[i]);
            }
            //var label = 'Current Status';
            //if (args.hasOwnProperty('line')) {
            //    label = 'Route ' + args.line;
            //}
            //var options = build_options(
            //    'status_chart', label, data.categories, data.series);
            //chart = new Highcharts.Chart(options);
        });
    }

    $('#filter_line a').on('click', function() {
        $("#line_btn").text(this.text+' ').append('<span class="caret"></span>');
        args = {};
        if (this.text != 'All') {
            args['line'] = this.text;
        }
        draw_chart(args);
    });

    draw_chart({});
    */
</script>
{% endblock %}

